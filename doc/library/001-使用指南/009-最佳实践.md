# 最佳实践

下面简单介绍一下在使用的过程中如何做到最佳实践。

## 日志接入最佳实践
对于Java而言，能使用异步就不要使用同步，对于自己开发的日志推送工具也是如此。

- 异步优先于同步
    - 异步需要在超时的时候触发保证一定的时效性
    - 异步需要在条数超标的时候发送防止积累太多发送中出错
- 不是每一次都需要压缩
    - 原则上，超过1k或者超过2k的数据才需要压缩，如果内网带宽无所谓且CPU宝贵可以考虑10k出发压缩


## 多机房日志统一收集最佳实践

如果你的应用都部署在一个局域网内，那么找一台服务器部署日志系统就可以了。

如果你的应用部署的非常分散（例如两地三中心这种的）推荐的做法是：
1. 每一个局域网内都部署一个Lofka服务器；
2. 最常用，且方便连接的服务器（称之为X）不要设置转发功能，并且对外开放一个域名（例如logger.example.com）
3. 对于服务器X，需要为其配置Kafka+MongoDB持久化
4. 对于其他每一个服务器：
    1. 都向该域名转发自己收集到的所有日志
    2. 扪心自问一下，该局域网收到的日志是否重要，如果很重要，则在该局域网内配置一套Kafka+MongoDB持久化
    3. 该域名所属的子系统配置好Lofka服务名称，如果没有特别指定就不需要配置

由于客户的网络环境不一定稳定，推荐单独用作日志服务器，同时具有单独的消息队列和存储层。

如果客户扣的一笔不肯提供单独的存储用于处理日志，至少也配置一台服务器作为转发服务器，转发服务器有如下作用：
- 为所有的日志的app_name加上前缀区别来源（通过配置lofka.application字段，参见：日志服务器配置中参数配置 ）
- 在IP链路中增加内网地址防止被运营商混淆
- 在外网不通的时候会自动写入本地文件防止关键日志丢失

## 应用名称命名最佳实践

1. 采用类似文件夹层级的命名方式，要能体现系统的层级结构；
2. 对于同样功能的单元（例如集群中的节点）应该赋予一样的名称，不一样的单元应该赋予不一样的名称；
3. app_name中应该尽可能的少出现特殊符号和中文。

这样做的目的是为了使日志的结构更加的清晰，以后可能会支持前缀语法的app_name过滤器。

命名示例：
- `google/online/database/mycat/node`
- `google/online/bigdata/spark/driver`
- `h5app/server/web`
- `h5app/server/dubbo`
- `h5app/database/mycat`

同时需要注意，如果一套系统有自己的日志服务器，而且服务器的系统名称已经设置（参见`高级应用/日志服务器配置`例如`h5app`），那么应该省略开头，例如`h5app`内的应用名称如下所示即可：
- `server/web`
- `server/dubbo`
- `database/mycat`

在转发的时候会被日志服务器自动变更为：
- `h5app/server/web`
- `h5app/server/dubbo`
- `h5app/database/mycat`
