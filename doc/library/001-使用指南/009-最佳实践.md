## 最佳实践

### 根据网络架构选择最佳实践

如果你的应用都部署在一个局域网内，那么找一台服务器部署日志系统就可以了。

如果你的应用部署的非常分散（例如两地三中心这种的）推荐的做法是：
1. 每一个局域网内都部署一个Lofka服务器；
2. 最常用，且方便连接的服务器（称之为X）不要设置转发功能，并且对外开放一个域名（例如logger.example.com）
3. 对于服务器X，需要为其配置Kafka+MongoDB持久化
4. 对于其他每一个服务器：
    1. 都向该域名转发自己收集到的所有日志
    2. 扪心自问一下，该局域网收到的日志是否重要，如果很重要，则在该局域网内配置一套Kafka+MongoDB持久化
    3. 该域名所属的子系统配置好Lofka服务名称，如果没有特别指定就不需要配置

由于客户的网络环境不一定稳定，推荐单独用作日志服务器，同时具有单独的消息队列和存储层。

如果客户扣的一笔不肯提供单独的存储用于处理日志，至少也[配置一台服务器](/高级应用/日志服务器配置)作为转发服务器，转发服务器有如下作用：
- 为所有的日志的app_name加上前缀区别来源（通过配置lofka.application字段，参见：日志服务器配置中参数配置 ）
- 在IP链路中增加内网地址防止被运营商混淆
- 在外网不通的时候会自动写入本地文件防止关键日志丢失

### 应用名称命名规范

1. 采用类似文件夹层级的命名方式，要能体现系统的层级结构；
2. 对于同样功能的单元（例如集群中的节点）应该赋予一样的名称，不一样的单元应该赋予不一样的名称；
3. app_name中应该尽可能的少出现特殊符号和中文。

这样做的目的是为了使日志的结构更加的清晰，以后可能会支持前缀语法的app_name过滤器。

命名示例：
- `cvnavi/online/database/mycat/node`
- `cvnavi/online/bigdata/spark/driver`
- `henan_zj/server/web`
- `henan_zj/server/dubbo`
- `henan_zj/database/mycat`

同时需要注意，如果一套系统有自己的日志服务器，而且服务器的系统名称已经设置（参见`高级应用/日志服务器配置`例如`henan_zj`），那么应该省略开头，例如`henan_zj`内的应用名称如下所示即可：
- `server/web`
- `server/dubbo`
- `database/mycat`

在转发的时候会被日志服务器自动变更为：
- `henan_zj/server/web`
- `henan_zj/server/dubbo`
- `henan_zj/database/mycat`
